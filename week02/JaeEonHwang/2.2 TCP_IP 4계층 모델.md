# 2. 네트워크
## 2.2 TCP/IP 4계층 모델
* 인터넷 프로토콜 스위트(internet protocol suite): 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜의 집합
* 계층 모델: 장치들이 인터넷 상에서 데이터를 주고받을 때 쓰는 독립적인 프로토콜의 집합
* TCP: Transmission Control Protocol
* IP: Internet Protocol

### 2.2.1 계층 구조
* 캡슐화와 비캡슐화
	* 캡슐화(encapsulation): 송신자가 수신자에게 데이터를 보낼 때 데이터가 각 계층을 지나며 각 계층의 특징들이 담긴 헤더들이 붙여지는 과정
	* 비캡슐화(decapsulation): 수신자측에서 캡슐화된 데이터를 역순으로 제거하면서 응용계층까지 도달하는 것
---
* PDU(protocol data unit): 각 계층의 데이터 단위
	* 애플리케이션 계층: 메시지
	* 전송 계층: 세그먼트(TCP), 데이터그램(UDP)
		* 세그먼트: 적절한 크기로 쪼갠 조각 (데이터그램과 의미는 같음)
	* 인터넷 계층: 패킷
		* 패킷: 세그먼트에 SP와 DP가 포함된 IP 헤더가 붙은 형태의 조각
		* SP: 송신자의 32비트 IP
		* DP: 수신자의 32비트 IP
	* 링크 계층: 프레임(데이터 링크 계층), 비트(물리 계층)
		* 프레임: MAC주소 헤더와 CRC/체크섬 트레일러가 붙은 조각
		* CRC/체크섬 트레일러: 데이터의 오류감지를 위한 수학적 함수가 적용된 값. 링크의 오류(과도한 트래픽 등)로 인해 데이터 손상을 감지하는 역할
---
* OSI 7계층 (차이점 면접에서 자주 나옴)

|TCP/IP 4계층|OSI 7계층|
|------|------|
|애플리케이션 계층|애플리케이션 계층|
||프레젠테이션 계층|
||세션 계층|
|전송 계층|전송 계층|
|네트워크 계층|네트워크 계층|
|링크 계층|데이터 링크 계층|
||물리 계층|

---
* MTU: 네트워크를 통신할 때 할 수 있는 가장 큰 PDU의 크기
	* 통신을 하는 양쪽 장치의 MTU 뿐만아니라, 중간의 모든 라우터/ 스위치/ 서버를 고려야햐함.
	* IP 헤더 + TCP 헤더 + payload
	* 네트워크 경로 상에 있는 MTU보다 패킷이 크면 해당 패킷이 분할되거나 아예 전달되지 않을 수 있음. (IPv6는 분할을 허용하지 않음)
	* 명령어를 통해 MTU 확인 가능
		* ping www.google.com -f -l 1500: 구글에 쪼갤 수 없는 1500바이트의 패킷을 보낸다.
		* netsh interface ipv4 show interfaces: 현재 시스템에 설정된 모든 네트워크 인터페이스의 목록과 상세 정보(MTU 포함)을 알 수 있다.
	* 일반적으로 1500바이트
* MSS: TCP에서 사용할 수 있는 데이터의 크기, MTU에서 TCP 헤더와 IP 헤더를 뺀 크기
	* 일반적으로 1460바이트
	* 실직적으로 보낼 수 있는 패킷의 크기는 MSS
* 이더넷 프레임: MTU에서 14바이트의 이더넷 헤더와 바이트의 FCS가 포함된 것
	* FCS(Frame Check Sequence): 데이터의 에러검출을 돕기 위해 삽입되는 필드
	* CRC에 의해 생성된 값이 여기에 포함
	* 그래서 이더넷 프레임의 크기는 일반적으로 1518바이트
* PMTUD(Path MTU Discovery): 수신자와 송진자의 경로 상에서 장치가 패킷을 누락한 경우, 테스크 패킷의 크기를 낮추면서 MTU에 맞게 반복해서 보내는 과정
---
1. 애플리케이션 계층
* 응용 프로그램이 사용되는 프로토콜의 계층
	* FTP
		* File Transfer Protocol
		* 장치와 장치 간의 파일을 전송하는 데 사용되는 표준 통신 프로토콜 
		* 지금은 암호화해서 전송하는 FTPS/SFTP로 대체되고 있음
		* ex) 파일질라
	* SSH
		* Secure Shell Protocol
		* 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
	* HTTP
		* Hypertext Transfer Protocol
		* World Wide Web을 위한 데이터 통신의 기초이자 웹 사이트를 이용하는 데 쓰는 프로토콜
		* 서버-브라우저, 서버-서버 간의 통신
		* 헤더를 통한 확장이 쉬움
		* 동일한 연결에서 연속적으로 수행되는 두 요청 사이에 연속적인 상태값이 없다. = stateless = 무상태성
	* SMTP
		* Simple Mail Transfer Protocol
		* 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
	* DNS: 도메인 이름과 IP 주소를 매핑해주는 서버
	* 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층
2. 전송 계층
* 애플리케이션 층에서 받은 메시지를 기반으로 세그먼트 또는 데이터그램으로 데이터를 쪼개고 데이터가 오류없이 순서대로 전달되도록 도움을 주는 층
* TCP
	* 가상회선패킷교환방식
	* 오류검사 매커니즘
		* 재전송: 정해진 시간이 지나면, 전달되지 않은 데어터에 대해 서버는 재전송을 시도
		* 체크섬: 무결성을 평가. 즉, 송신된 데이터의 체크섬과 수신된 데이터의 체크섬 값을 비교해서 올바르게 왔는지 확인
	* 헤더: 20 ~ 60 바이트
* UDP
	* 데이터그램패킷교환방식
	* 오류검사는 체크섬만 지원
	* 헤더: 8바이트 고정

중요!
||TCP(전송제어 프로토콜)|UDP(사용자 데이터그램 프로토콜)|
|---|---|---|
|패킷교환방식|가상회선패킷교환방식|데이터그램패킷교환방식|
|신뢰성|O|X|
|오류검사|재전송, 체크섬|체크섬|
|패킷의 순서보장|O|X|
|해더 길이|20~60바이트 가변 길이|8바이트 고정 길이|
|연결보장|연결을 보장함. 3웨이 - 핸드셰이크로 연결을 맺고, 4-웨이 핸드셰이크로 연결을 해제하는 작업이 필요|연결을 보장하지 않고 데이터를 보냄. 연결을 유지하고 해제하는데 드는 비용이 없음|
|브로드캐스트지원|X|O|
|속도|느림|빠름|

---
* TCP의 연결성립과정: 3-way 핸드셰이크
1. SYN 단계: 클라이언트가 서버에 클라이언트의 ISN을 담아 SYN을 보냄
2. SYN + ACK 단계: 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며, 승인번호로 클리아언트의 ISN + 1을 보냄
3. ACK 단계: 클라이언트는 서버의 ISN + 1 값인 승인번호를 담아 ACK를 서버에 보냄

* ISN: TCP 기반 데이터 통신에서 각각의 새 연결에 할당된 고유한 32비트 시퀀스 번호. TCP 연결을 통해 전송되는 데이터들이 고유의 시퀀스 번호를 갖게 함
* SYN: synchronization의 약자, 연결 요청 플래그
* ACK: acknowledgement의 약자, 응답 플래그

* 이러한 서버와 클라이언트 간의 연결 설정 과정이 있기 때문에 TCP는 신뢰성이 있고, UDP는 신뢰성이 없다.
---
TCP의 연결해제과정: 4-way 핸드셰이크와 TIME_WAIT
1. 클라이언트가 연결을 닫으려고 할 때, FIN으로 설정된 세그먼트를 보냄.
2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보내고 ClOSE_WAIT 상태가 됨. 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태가 됨
3. 서버는 LAST_ACK 상태가 되며, 일정 시간 이후에는 클라이언트에 FIN이라는 세크먼트를 보냄
4. 클라이언트는 TIME_WAIT 상태가 되고, 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 됨
5. 이후 클라이언트는 어느 정도의 시간(TIME_WAIT으로 설정된 시간)을 대기한 후 CLOSED 상태가 됨
	* TIME_WAIT
		1. 지연패킷을 받기 위함: 데이터의 무결성, 일관성, 정확성
		2. 다시 연결될 때 올바르게 연결되려면 클라이언트와 서버 모두 CLOSED 상태여야함
		3. 두 배의 최대 세그먼트 수명(MSL) 기다림. MSL은 기본적으로 2분
---
3. 인터넷 계층
* 전송 계층에서 받은 세그먼트 또는 데이터그램을 패킷화하여, 한 노드에서 다른 노드로 전송하는 역할
* IP
* ICMP
	* Internet Control Message Protocol
	* 노드와 노드 사이에서 통신이 잘 되는지 확인할 때 사용하는 프로토콜
	* 데이터를 교환하지는 않음
	* 일반적으로 테스팅에 사용
	* IP와 달리, TCP 또는 UDP와 같은 전송 계층 프로토콜과 연관되어 있지 않은 독립적인 비연결형 프로토콜
	* 비연결형 프로토콜을 기반으로 구축
	* ex) ping 명령어
* ARP
4. 링크 계층
* 전선, 광섬유, 무선 등으로 데이터가 네트워크를 통해 물리적으로 전송되는 방식을 정의
* 물리 계층: 무선 LAN과 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
* 데이터 링크 계층: '이더넷 프레임'을 통해 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층
---
* 유선 LAN(IEEE802.3)
1. 전이중화 통신(full duplex)
	* full duplex
	* 양쪽 장치가 동시에 송수신할 수 있는 방식
	* 현대 고속 이더넷에서 통신하는 방식
2. 반이중화 통신(half duplex)
	* CSMA/CD(Carrier Sense Multiple Access with Collision Detection)
	* 과거에 쓰이던 방식
	* 데이터를 보낸 이후 충돌이 발생한다면 일정 시간 이후 재전송하는 방식
	* 수신로와 송신로를 각각 두지 않고 한 경로를 기반으로 데이터를 보냈기 때문에 충돌에 대비했어야 함
3. 유선 LAN을 이루는 케이블
	* 트위스트 페어 케이블(TP 케이블)
		* 여덟개의 구리선을 두 개씩 꼬와서 묶은 케이블의 총칭
		* 구리선에 실드 처리하지 않고 덮은 UTP 케이블, 실드 처리하고 덮은 STP 케이블
		* 흔히 LAN 케이블이라고 부리는 것은 UTP 케이블
		* LAN 케이블을 꽂는 커넥터는 RJ-45 커넥터라고 함
	* 광섬유 케이블
		* 광섬유로 만든 케이블
		* 레이저를 이용하기 때문에 장거리 및 고속 통신이 가능
		* 보통 100Gbps의 데이터를 전송
		* 빛의 굴절률이 높은 내부를 코어, 굴절률이 낮은 외부를 클래딩이라고 함
---
* 무선 LAN(IEEE802.11)
1. 반이중화 통신
	* 무선 LAN 장치는 수신과 송신에 같은 채널을 사용하기 때문에 반이중화 통신만을 사용
	* 양방향으로 통신 가능하지만, 동시 통신은 불가능
	* 장치가 신호를 수신하기 시작하면 전송이 완료될 때까지 기다려야 함.
	* 동시에 전송될 경우 충돌이 발생하기 때문에 충돌 방지 시스템이 필요
2. CSMA/CA
	* 반이중화 통신 중 하나
	* 장치에서 데이터를 보내기 전에 캐리어 감지 등으로 충돌을 방지
		1. 데이터를 송신하기 전에 무선 매체를 살핌
		2. 캐리어 감지: 회선이 비어 있는지를 판단
		3. IFS(Inter FrameSpace): 랜덤 값을 기반으로 정해진 시간만큼 기다리며, 만약 무선 매체가 사용 중이면 점차 그 간격을 늘려가며 기다림
		4. 이후 데이터 송신